# FPGAppy Bird
This project was created for a course in digital electronics on the fifth semester
of Electronics and Computer Engineering at the University of Southern Denmark.

The project is an FPGA (VHDL) implementation of the game "Flappy Bird" using a Digilent
Nexys 2 Spartan-3E FPGA trainer board and a Digilent PmodAD1 analog-to-digital converter.
The code was developed using Xilinx ISE 14.7 on Ubuntu 18.04.

## Project description
In the classic *Flappy Bird* game, the player controls a bird and must avoid obstacles
by pressing a button to make the bird fly higher. In this project, the bird is instead
controlled via an analog input (potentiometer, IR sensor or something else) that determines
the bird's absolute vertical position on the screen. The video signal is sent out on the
VGA port and the player's current score is shown on the multiplexed 7-segment display.

# Components
A block diagram of the system is shown in the image below. VHDL modules are displayed as
rectangles and external hardware as circles.

*INSERT IMAGE HERE*

In the following sections, the purpose of each component is briefly described.

## ADC interface and sampler
The PmodAD1 is a 2-channel 12-bit ADC with a maximum sampling rate of 1 MSa/s. When sampling a 12-bit
value, it is necessary to sample 16-bits, the first four being zeroes. The first bit is generated
by setting the chip select (CS) pin low and the remaining 15 bits are generated on the falling edge
of the serial clock. All this timing is taken care of by the adc_interface module. When the
start-input is set high, a 12-bit value is fetched from each of the channels. When the sampling is done
the done-output goes high and the 12-bit values are available on the AD1 and AD2 busses of the interface.

The sampler module controls the actual sampling rate, by setting the start signal at an interval determined
by prescaler input bus. The 50 MHz system clock is automatically scaled to by 50 to give a maximum
sampling rate of 1 MHz (prescaler set to 0 or 1). Note that this is not currently supported by the
adc_interface, which can handle a maximum of around 500 kHz. In the top module of the project, the prescaler
input is set to 16666, resulting in a sampling frequency of approximately 60 Hz.

## 7-segment driver and binary-to-BCD converter
The display driver takes a 16-bit binary coded decimal (BCD) value, a 4-bit vector for the four decimal points, and the system clock
as input. The 16-bit BCD value is generated by the binary2bcd module, which converts a 12-bit binary value to
a 16-bit BCD value using the *double-dabble* algorithm.

In the display driver module, the 16-bit BCD value is sent to a 16-to-4 multiplexer and the 4-bit decimal point vector is sent
to a 4-to-1 multiplexer. A 2-bit counter then controls which of the four BCDs and decimal points is shown on the 7-segment display,
and at which position. The counter runs at a 1 kHz clock, so the digits seem to appear simultaneously on the display.

## VGA driver, game renderer and graphics ROM
The VGA driver handles all timing og signals which is necessary to show graphics on a VGA display. The VGA standard
calls for a display refresh rate of 60 Hz and with a display are of 640x480 pixel, it is necessary to scan 800 counts
horisontally and 525 counts vertically, when including the front porch, back porch and synchronisation pulse.
The clock necessary to achieve this is 800x525x60 = 25.2 MHz. Round this off to 25 MHz gives us a refresh rate of
59.5 Hz, which is close enough. The VGA driver is responsible for generating this VGA clock and setting the 
VSYNC and HSYNC signals with the correct timing. It also keeps track of the current vertical and horisontal position
on the screen and determines whether it is allowed to set the RGB pins or not (RGB enable bit). The RGB pins should
only be set within the display area and should all be zero during the front porch, back porch and synchronisation pulse.

The game_render module takes the vertical and horisontal position and the RGB enable bit and draws the actual
game screen on the display. To draw the player and obstacle sprites on the screen, it also takes
the obstacle's current x- and y-position, and the player's y-position (constant x-position) as input.
The player sprite ("Flappy bird") is drawn from the bird_rom module, which contains a 17x12 pixel bitmap.

## Game state machine and game clock


## Obstacle, player and collision detection
